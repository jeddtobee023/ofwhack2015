<!DOCTYPE html>
<html>
   <head>
      <title>OFW Hack 2015</title>
      <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" >
      <meta charset="utf-8">
      <link rel="stylesheet" href="css/bootstrap.min.css" media="screen">
	  <link rel="stylesheet" href="css/font-awesome.min.css">
	  <link rel="stylesheet" href="css/animate.min.css">
      <style>
		body
		{
		background: #d3d3d3;
		padding-top:125px;
		padding-bottom: 5px;
		display:none;
		}
		 .navbar-fixed-top .row
		 {
		 margin:0;
		 padding:0;
		 }
		 .menu-top
		 {
		 padding:0;
		 padding-top:10px;
		 background:#333;
		 }
		 .menu-top .col-xs-3
		 {
		 padding:0;
		 padding-bottom:5px;
		 color:#b4bcc2;
		 text-decoration: none;
		 text-align: center;
		 font-size: 0.9em;
		 }
		 .menu-top .active
		 {
		 border-bottom: 5px solid #3498db;
		 color: #f3f3f3;
		 }
		 .animated
		 {
		 -webkit-animation-duration: 0.55s;
		 animation-duration: 0.55s;
		 }
		 .list-group-notifications .list-group-item
		 {
		 border-left: 0;
		 border-right: 0;
		 border-radius:0;
		 }
      </style>
   </head>
   <body>
		<div class="navbar navbar-fixed-top" style="background: #f3f3f3;color:#333">
			<div class="container-fluid" style="padding: 10px;">
				<div class="row">
				  <div class="col-xs-6" style="padding:0">
				  <img src="images/ihlogo-alt.png" style="width:42px">
				  </div>
				  <div class="col-xs-6 text-right" style="padding:0">
				  <h4><i class="fa fa-refresh fa-lg"></i></h4>
				  </div>
				</div>
			</div>
			<div class="container-fluid menu-top">
				<div class="row">
				  <a href="home.html" class="col-xs-3 active tab-btn">
				  <i class="fa fa-th-large fa-lg fa-fw"></i><br>Notifications
				  </a>
				  <a href="tracklist.html" class="col-xs-3 tab-btn">
				  <i class="fa fa-map-marker fa-lg fa-fw"></i><br>Tracklist
				  </a>
				  <a href="messages.html" class="col-xs-3 tab-btn">
				  <i class="fa fa-envelope fa-lg fa-fw"></i><br>Messages
				  </a>
				  <a href="profile.html" class="col-xs-3 tab-btn">
				  <i class="fa fa-user fa-lg fa-fw"></i><br>Profile
				  </a>
				</div>
			</div>
		</div>
		<div class="btn-context">
		<a href="panicbutton.html" class="fa-stack fa-2x img-circle btn-up"style="background:#333;-webkit-box-shadow:0px 0px 2px 2px rgba(0,0,0,0.6);box-shadow:0px 0px 2px 2px rgba(0,0,0,0.6)">
		  <i class="fa fa-stack-2x img-circle"></i>
		  <i class="fa fa-exclamation-triangle fa-stack-1x fa-inverse"></i>
		</a>
		</div>
		
		<div class="container" style="padding-left:0;padding-right:0;">
		<div class="center-block" style="max-width:700px;">
				<div class="list-group list-group-notifications">
				<div id="notilistloader" class="list-group-item">
					<svg class="spinner center-block" width="65px" height="65px" viewBox="0 0 66 66">
					<circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle>
					</svg
				</div>
				<!--
				<div class="list-group-item list-group-item-danger">
					<span class="label label-default pull-right">2 minutes ago</span>
					<span class="fa-stack fa-3x pull-left">
					  <i class="fa fa-circle fa-stack-2x" style="color: #333"></i>
					  <i class="fa fa-flag fa-stack-1x fa-inverse"></i>
					</span>
					<h3>Amy needs Emergency!</h3>
					Amy pushed the Panic Button
					<span class="clearfix"></span>
				</div>
				<div class="list-group-item list-group-item-success">
					<span class="label label-default pull-right">1 hour ago</span>
					<span class="fa-stack fa-3x pull-left">
					  <i class="fa fa-circle fa-stack-2x" style="color: #333"></i>
					  <i class="fa fa-user-times fa-stack-1x fa-inverse"></i>
					</span>
					<h3>Jonathan's Location</h3>
					It seems Jonathan is outside the school premises today.
					<span class="clearfix"></span>
				</div>
				<div class="list-group-item list-group-item-warning">
					<span class="label label-default pull-right">2 hours ago</span>
					<span class="fa-stack fa-3x pull-left">
					  <i class="fa fa-circle fa-stack-2x" style="color: #333"></i>
					  <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
					</span>
					<h3>New Message</h3>
					From: Mama - Dad, When will you come home? We will having...
					<span class="clearfix"></span>
				</div>
				<div class="list-group-item  list-group-item-success" style="background: #333">
					<span class="label label-default pull-right">Reminder</span>
					<a href="" class="fa-stack fa-3x pull-left btn-forward">
					  <i class="fa fa-circle fa-stack-2x text-danger"></i>
					  <i class="fa fa-calendar fa-stack-1x fa-inverse"></i>
					</a>
					<h3>Reginald's Birthday Today!</h3>
					Call or Message Reginald now.
					<span class="clearfix"></span>
				</div>
				<div class="list-group-item list-group-item-danger">
					<button id="testNoti" class="btn btn-info btn-lg btn-block">Test Notification</button>
				</div>
				-->
				</div>
		</div><!--center-block-->
		</div><!--container-fluid-->
		  
		
      <script src="js/jquery-1.11.2.min.js"></script>
      <script src="js/bootstrap.min.js"></script>
	  <script src="js/fastclick.min.js"></script>
	  <script src="js/jquery.timeago.js"></script>
	  <script>
	  var notitimer;
	  $(function()
	  {
	  $("body").fadeIn("fast");
	  $("abbr.timeago").timeago();
	  localStorage.removeItem("imhome-lastnotidate");
	  setTimeout(function()
	  {
		 $.getJSON("http://imhome.iligtas.ph/getnotifications.php", {uniquekey:localStorage.getItem("imhome-uniquekey")},function(data)
         		{
					var itemtype =" ";
					//$(".list-group-notifications").empty();
					$.each(data, function(key, value) {
					if (value['type'] == "pb")
					{
					$(".list-group-notifications").prepend('<div class="list-group-item list-group-item-danger" style="display:none"><abbr class="label label-default pull-right timeago" title="'+value['notidate']+'">'+value['notidate']+'</abbr><span class="fa-stack fa-3x pull-left"><i class="fa fa-circle fa-stack-2x" style="color: #333"></i><i class="fa fa-flag fa-stack-1x fa-inverse"></i></span><h3>'+value['alias']+' buzzed!</h3>'+value['alias']+' pressed the Panic Button<span class="clearfix"></span></div>');
					}
					if (key >= data.length - 1)
					{
					 localStorage.setItem("imhome-lastnotidate",value['notidate']);
					}
					$("abbr.timeago").timeago();
					$(".list-group-item").slideDown("fast");
					});
					$("#notilistloader").slideUp();
				}).fail(function(){
				
				});
		notitimer = setInterval(function()
		{
			if(localStorage.getItem("imhome-lastnotidate") != undefined || localStorage.getItem("imhome-lastnotidate") != null)
			{
				$.getJSON("http://imhome.iligtas.ph/getnotifications.php", {uniquekey:localStorage.getItem("imhome-uniquekey"), offsetdate: localStorage.getItem("imhome-lastnotidate")},function(data)
         		{
					var itemtype =" ";
					//$(".list-group-notifications").empty();
					$.each(data, function(key, value) {
					if (value['type'] == "pb")
					{
					$(".list-group-notifications").prepend('<div class="list-group-item list-group-item-danger" style="display:none"><abbr class="label label-default pull-right timeago" title="'+value['notidate']+'">'+value['notidate']+'</abbr><span class="fa-stack fa-3x pull-left"><i class="fa fa-circle fa-stack-2x" style="color: #333"></i><i class="fa fa-flag fa-stack-1x fa-inverse"></i></span><h3>'+value['alias']+' buzzed!</h3>'+value['alias']+' pressed the Panic Button<span class="clearfix"></span></div>');
					$("body").trigger("notifyandroid",[value['alias']+' needs Emergency!',value['alias']+' pressed the Panic Button']);
					}
					if (key >= data.length - 1)
					{
					 localStorage.setItem("imhome-lastnotidate",value['notidate']);
					}
					$("abbr.timeago").timeago();
					$(".list-group-item").slideDown("fast");
					});
					$("#notilistloader").slideUp();
				});
			}
		},12000);
	  },500);
	  });
	  $("#testNoti").click(function(){
		alert("If you see this, either there's an error or notifications hasn't been loaded");
	  });
	  
	  </script>
   </body>
</html>